---
import FormatQuoteIcon from "@mui/icons-material/FormatQuote";
import AvatarTestimonialSection from "@components/ui/avatars/AvatarTestimonialSection.astro";
import FavoriteIcon from "@mui/icons-material/Favorite";

interface Props {
    id: string;
    content: string;
    secondContent: string;
    thirdContent: string;
    fourthContent: string;
    fifthContent: string;
    author: string;
    role: string;
    avatarSrc: string;
    avatarAlt: string;
    imageSrc: string;
    imageAlt: string;
}

const {
    id,
    content,
    secondContent,
    thirdContent,
    fourthContent,
    fifthContent,
    author,
    role,
    avatarSrc,
    avatarAlt,
    imageSrc,
    imageAlt,
} = Astro.props;
---

<div
    id={id}
    class="testimonial-popup fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm"
    data-testimonial-id={id}
>
    <div
        class="relative mx-4 max-w-2xl rounded-xl bg-white p-6 shadow-2xl dark:bg-neutral-800"
    >
        <!-- Close Button -->
        <button
            class="absolute -top-2 -right-2 flex h-8 w-8 items-center justify-center rounded-full bg-neutral-200 text-neutral-600 hover:bg-neutral-300 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-600"
            onclick={`closeTestimonialPopup('${id}')`}
            aria-label="Close testimonial"
        >
            <svg
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>

        <!-- Testimonial Content -->

        <div class="flex h-auto">
            <div
                class="flex h-full flex-col rounded-xl border-l-5 border-indigo-600 bg-yellow-50/60 dark:border-yellow-400 dark:bg-neutral-700"
            >
                <div class="flex-auto p-4 md:p-6">
                    <!-- Testimonial content -->
                    <p
                        class="text-base text-pretty text-black italic md:text-lg dark:text-white"
                    >
                        <FormatQuoteIcon
                            style={{ transform: "rotate(180deg)" }}
                        />
                        {
                            author === "Oana Catrinel Bogatu" ? (
                                <>
                                    <Fragment set:html={content} />
                                    <br />
                                    &nbsp;&nbsp;&nbsp;
                                    <Fragment set:html={secondContent} />
                                    <br />
                                    &nbsp;&nbsp;&nbsp;
                                    <Fragment set:html={thirdContent} />
                                    <br />
                                    &nbsp;&nbsp;&nbsp;
                                    <Fragment set:html={fourthContent} />
                                    <br />
                                    <Fragment set:html={fifthContent} />
                                </>
                            ) : author === "Iulian Vasile" ? (
                                <>
                                    <Fragment set:html={content} />
                                    <br />
                                    &nbsp;&nbsp;&nbsp;
                                    <Fragment set:html={secondContent} />
                                </>
                            ) : author === "Dan Cedric Prica" ? (
                                <>
                                    <Fragment set:html={content} />
                                    <br />
                                    &nbsp;&nbsp;&nbsp;
                                    <Fragment set:html={secondContent} />
                                </>
                            ) : author === "Cristinel-Ionel Maxim" ? (
                                <>
                                    <Fragment set:html={content} />
                                    <br />
                                    &nbsp;&nbsp;&nbsp;
                                    <Fragment set:html={secondContent} />
                                    <br />
                                    &nbsp;&nbsp;&nbsp;
                                    <Fragment set:html={thirdContent} />
                                    <br />
                                    &nbsp;&nbsp;&nbsp;
                                    <Fragment set:html={fourthContent} />
                                </>
                            ) : (
                                <Fragment set:html={content} />
                            )
                        }
                        <FormatQuoteIcon />
                    </p>
                </div>

                <div
                    class="rounded-b-xl bg-neutral-300/30 p-4 md:px-7 dark:bg-neutral-900/30"
                >
                    <div class="flex items-center">
                        <AvatarTestimonialSection
                            src={avatarSrc}
                            alt={avatarAlt || ""}
                        />

                        <div class="ms-3 grow">
                            <p
                                class="text-sm font-bold text-neutral-800 sm:text-base dark:text-neutral-200"
                            >
                                {author}
                            </p>
                            <p
                                class="text-sm font-bold text-indigo-600 dark:text-yellow-400"
                            >
                                {role}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function openTestimonialPopup(id: string) {
        const popup = document.getElementById(id);
        if (popup) {
            popup.classList.remove("hidden");
            popup.classList.add("flex");
            document.body.style.overflow = "hidden";
        }
    }

    function closeTestimonialPopup(id: string) {
        const popup = document.getElementById(id);
        if (popup) {
            popup.classList.add("hidden");
            popup.classList.remove("flex");
            document.body.style.overflow = "auto";
        }
    }

    // Close popup when clicking outside
    document.addEventListener("click", (e) => {
        const target = e.target as HTMLElement;
        if (target.classList.contains("testimonial-popup")) {
            const popupId = target.getAttribute("data-testimonial-id");
            if (popupId) {
                closeTestimonialPopup(popupId);
            }
        }
    });

    // Close popup with Escape key
    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
            const openPopup = document.querySelector(
                ".testimonial-popup:not(.hidden)",
            );
            if (openPopup) {
                const popupId = openPopup.getAttribute("data-testimonial-id");
                if (popupId) {
                    closeTestimonialPopup(popupId);
                }
            }
        }
    });

    // Make functions globally available
    (window as any).openTestimonialPopup = openTestimonialPopup;
    (window as any).closeTestimonialPopup = closeTestimonialPopup;
</script>

<style>
    .testimonial-popup {
        animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
</style>
